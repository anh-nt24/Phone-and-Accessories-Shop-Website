<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>POS - Reset password</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

    <!-- Favicon -->
    <link href="/images/phone.png" rel="icon">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="lib/tempusdominus/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet" />

    <!-- Customized Bootstrap Stylesheet -->
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/css/style.css" rel="stylesheet">
    <style>
    @keyframes drop-in-fade-out {
        0% {
            opacity: 0;
            visibility: visible;
            transform: translate3d(0, -200%, 0);
        }

        12% {
            transform: translate3d(0, 0, 0);
        }

        20% {
            opacity: 1;
        }

        70% {
            opacity: 1;
            visibility: visible;
            transform: translate3d(0, 0, 0);
        }

        80% {
            opacity: 0;
        }

        100% {
            visibility: hidden;
            transform: translate3d(75%, 0, 0);
        }
    }

    .animate--drop-in-fade-out {
        animation: drop-in-fade-out 3.5s 0.4s cubic-bezier(.32, 1.75, .65, .91);
    }


    @-webkit-keyframes drop-in-fade-out {
        0% {
            opacity: 0;
            visibility: visible;
            -webkit-transform: translate3d(0, -200%, 0);
        }

        12% {
            -webkit-transform: translate3d(0, 0, 0);
        }

        20% {
            opacity: 1;
        }

        70% {
            opacity: 1;
            visibility: visible;
            -webkit-transform: translate3d(0, 0, 0);
        }

        80% {
            opacity: 0;
        }

        100% {
            visibility: hidden;
            -webkit-transform: translate3d(75%, 0, 0);
        }
    }

    @-moz-keyframes drop-in-fade-out {
        /* Same as above, replace -webkit- with -moz- */
    }

    @-o-keyframes drop-in-fade-out {
        /* Same as above, replace -webkit- with -o- */
    }

    @-ms-keyframes drop-in-fade-out {
        /* Same as above, replace -webkit- with -ms- */
    }

    .flash {
        display: block;
        position: fixed;
        bottom: 20px;
        right: 25px;
        width: 350px;
        padding: 20px 25px 20px 85px;
        font-size: 16px;
        font-weight: 400;
        color: #ff4d4d;
        background-color: #FFF;
        border: 2px solid #ff4d4d;
        border-radius: 2px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.25);
        opacity: 0;
    }

    .flash.success {
        border-color: #51a626 !important;
        color: #51a626 !important;
    }

    .flash__icon.success {
        background: #51a626 !important;
    }

    .flash__icon {
        position: absolute;
        top: 50%;
        left: 0;
        width: 1.8em;
        height: 100%;
        padding: 0 0.4em;
        background-color: #ff4d4d;
        color: #FFF;
        font-size: 36px;
        font-weight: 300;
        transform: translate(0, -50%);
    }

    .flash__icon .icon {
        position: absolute;
        top: 50%;
        transform: translate(0, -50%);
    }
</style>
</head>

<body>

    <div class="container-fluid position-relative bg-white d-flex p-0">
        <!-- Sign In Start -->
        <div class="container-fluid">
            <div class="row h-100 align-items-center justify-content-center" style="min-height: 100vh;">
                <div class="col-12 col-sm-8 col-lg-5">
                    <div class="bg-light rounded p-4 p-sm-5 my-4 mx-3">
                        <div class="d-flex align-items-center justify-content-between mb-3">
                            <a href="index.html" class="">
                                <h3 class="text-primary"><i class="fa fa-hashtag me-2"></i>POS</h3>
                            </a>
                            <h3>Reset password</h3>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="password" class="form-control" id="old-password" placeholder="Older password" required="true">
                            <label for="old-password">Old password</label>
                        </div>
                        <div class="form-floating mb-4">
                            <input type="password" class="form-control" id="password" placeholder="Password"
                                required="true">
                            <label for="password">New password</label>
                        </div>
                        <div class="form-floating mb-4">
                            <input type="password" class="form-control" id="retype-password" placeholder="Retype password"
                                required="true">
                            <label for="retype-password">Retype password</label>
                        </div>
                        <p style="color: red;" id="status"></p>
                        <div class="d-flex align-items-center justify-content-between mb-4">
                            <a href="">Forgot Password</a>
                        </div>
                        <button onclick="changepassword()" class="btn btn-primary py-3 w-100 mb-4">Sign In</button>
                    </div>
                    <div class="flash" id="flashMessage">
                            </div>
                </div>
            </div>
        </div>
        <!-- Sign In End -->
    </div>

    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="lib/chart/chart.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="lib/tempusdominus/js/moment.min.js"></script>
    <script src="lib/tempusdominus/js/moment-timezone.min.js"></script>
    <script src="lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>

    <!-- Template Javascript -->
    <script src="/js/changepassword.js"></script>

    <script>
        const data = JSON.parse(sessionStorage.getItem('information'));
        const changepassword = () => {
            const oldPassword = document.getElementById('old-password').value;
            const password = document.getElementById('password').value;
            const retypePassword = document.getElementById('retype-password').value;
            const status = document.getElementById('status');

            if (password != retypePassword) {
                status.innerText = 'Password and retype-password do not match';
                return ;
            } else {
                const credentials = {
                    UserName: data.UserName,
                    Password: password,
                    OldPassword: oldPassword,
                    Avatar: data.Avatar
                };
                
                fetch('/api/login/changeInfo', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(credentials)
                })
                    .then(response => {
                        if (!response.ok && response.status == 400) {
                            status.innerText = 'Wrong password';
                            throw new Error('Change failed');
                        }

                        const flash = document.querySelector('#flashMessage');
                        let type = 'success';
                        let message = 'The information has been successfully changed'
                        if (!response.ok) {
                            type = 'failed';
                            message = 'The information has been failed changed'
                            throw new Error(response.status);
                        }
                        let html = `
                            <div class="flash__icon ${type}">
                                ${type === 'success' ?
                                    '<i class="icon fa fa-check"></i>' :
                                    '<i class="icon fa fa-times-circle-o"></i>'
                                }
                            </div>
                            <p>${message}</p>
                        `;

                        flash.innerHTML = html;
                        flash.classList.add(type);
                        flash.classList.add("animate--drop-in-fade-out");
                        // Remove the animation class after 3 seconds
                        setTimeout(function () {
                            flash.classList.remove("animate--drop-in-fade-out");
                            if (sessionStorage.getItem("passwordChanged")) {
                                sessionStorage.removeItem('passwordChanged');
                            }
                            window.location.href = '/';
                        }, 3000);
                    })
            }
        }
     
    </script>
</body>

</html>